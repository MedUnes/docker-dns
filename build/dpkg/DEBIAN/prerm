#!/bin/bash
set -e

SERVICE=docker-dns
BIN=/usr/bin/docker-dns

if systemctl is-active --quiet "$SERVICE.service"; then
    echo "Stopping $SERVICE.service in prerm..."
    systemctl stop "$SERVICE.service" || true
fi

# Kill only matching docker-dns binaries (ignore prerm)
for pid in $(pgrep -f "/usr/bin/docker-dns"); do
  cmd=$(ps -p "$pid" -o args=)
  if echo "$cmd" | grep -q "^/usr/bin/docker-dns"; then
    echo "Killing docker-dns process (PID: $pid)"
    kill -9 "$pid" || true
  fi
done

exit 0
